import * as FormData from "form-data";
import nf from "node-fetch";

export default async (
	apiKey: string,
	form: FormData
): Promise<{ id: string; EstimatedAnalysisTime: number }> => {
	try {
		const res = await nf("https://www.malware.ai/api/files/", {
			method: "POST",
			headers: {
				Authorization: `Bearer ${apiKey}`,
				// "Content-Type": `multipart/form-data; boundary=${form.getBoundary()}`,
				// "Content-Length": (size as unknown) as string,
				// using form headers since manual content length is not working
				...form.getHeaders(),
			},
			body: form,
		});

		if (res.status !== 200)
			throw new Error(`${res.status} - ${res.statusText}: ${await res.json()}`);
		return res.json();
	} catch (error) {
		throw error;
	}
};
